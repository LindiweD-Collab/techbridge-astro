---
const products = [
  {
    id: "digital",
    name: "Digital Literacy & IT Skills",
    price: 999,
    yoco: "https://pay.yoco.com/digital-yoco",
    ozow: "https://pay.ozow.com/digital-ozow"
  },
  {
    id: "fullstack",
    name: "Full-Stack Web Development",
    price: 3999,
    yoco: "https://pay.yoco.com/fullstack-yoco",
    ozow: "https://pay.ozow.com/fullstack-ozow"
  },
  {
    id: "cyber",
    name: "Cybersecurity Program",
    price: 4499,
    yoco: "https://pay.yoco.com/cyber-yoco",
    ozow: "https://pay.ozow.com/cyber-ozow"
  }
];
---

<div id="payment-modal" class="modal hidden">
  <div class="modal-content">

    <h2>Complete Your Enrollment</h2>

    <!-- Course -->
    <label>Course</label>
    <select id="product-select">
      {products.map(p => (
        <option value={p.id}>{p.name}</option>
      ))}
    </select>

    <!-- Price -->
    <p id="price-display" class="price">R {products[0].price}</p>

    <!-- Payment Method -->
    <label>Payment Method</label>
    <select id="payment-method">
      <option value="yoco">Yoco (Card Payment)</option>
      <option value="ozow">Ozow (Instant EFT)</option>
    </select>

    <!-- Checkout -->
    <a id="pay-button" class="pay-btn" href={products[0].yoco} target="_blank">
      Proceed to Payment
    </a>

    <button id="close-modal" class="close-btn">Close</button>

  </div>
</div>

<style>
  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.6);
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 2rem;
  }
  .hidden { display: none; }

  .modal-content {
    background: white;
    padding: 2rem;
    border-radius: 10px;
    max-width: 400px;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .pay-btn {
    padding: 0.8rem;
    background: #0047b3;
    border-radius: 6px;
    text-align: center;
    color: white;
    font-weight: bold;
  }
  .close-btn {
    padding: .7rem;
    background: #ccc;
    border-radius: 6px;
  }
  .price {
    font-size: 1.2rem;
    font-weight: bold;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const products = JSON.parse(`{JSON.stringify(products)}`);

    const modal = document.getElementById("payment-modal");
    const closeModal = document.getElementById("close-modal");

    const productSelect = document.getElementById("product-select");
    const paymentMethod = document.getElementById("payment-method");
    const priceDisplay = document.getElementById("price-display");
    const payButton = document.getElementById("pay-button");

    window.openPayment = function(productId) {
      modal.classList.remove("hidden");
      productSelect.value = productId;
      updateCheckout();
    };

    function updateCheckout() {
      const item = products.find(p => p.id === productSelect.value);
      const method = paymentMethod.value;

      priceDisplay.textContent = "R " + item.price;
      payButton.href = item[method];
    }

    productSelect.addEventListener("change", updateCheckout);
    paymentMethod.addEventListener("change", updateCheckout);

    closeModal.addEventListener("click", () => modal.classList.add("hidden"));
  });
</script>

