---
import BaseLayout from '../layouts/BaseLayout.astro';
import { courses } from '../data/courses.js';

const LINKS = {
    'digital-literacy': { yoco: "https://pay.yoco.com/digital-literacy", ozow: "https://pay.ozow.com/digital-literacy" },
    'full-stack': { yoco: "https://pay.yoco.com/fullstack", ozow: "https://pay.ozow.com/fullstack" },
    'cybersecurity': { yoco: "https://pay.yoco.com/cyber-security", ozow: "https://pay.ozow.com/cyber-security" },
    'rpa': { yoco: "https://pay.yoco.com/rpa", ozow: "https://pay.ozow.com/rpa" },
    'data-science': { yoco: "https://pay.yoco.com/data-science", ozow: "https://pay.ozow.com/data-science" },
    'cloud-devops': { yoco: "https://pay.yoco.com/cloud", ozow: "https://pay.ozow.com/cloud" },
    'entrepreneurship': { yoco: "https://pay.yoco.com/entrepreneur", ozow: "https://pay.ozow.com/entrepreneur" },
    'business-management': { yoco: "https://pay.yoco.com/management", ozow: "https://pay.ozow.com/management" },
    'financial-literacy': { yoco: "https://pay.yoco.com/finance", ozow: "https://pay.ozow.com/finance" },
    'digital-marketing': { yoco: "https://pay.yoco.com/marketing", ozow: "https://pay.ozow.com/marketing" },
    'project-management': { yoco: "https://pay.yoco.com/pmp", ozow: "https://pay.ozow.com/pmp" },
    'executive-education': { yoco: "https://pay.yoco.com/executive", ozow: "https://pay.ozow.com/executive" },
    'it-support': { yoco: "https://pay.yoco.com/it-support", ozow: "https://pay.ozow.com/it-support" },
    'business-analysis': { yoco: "https://pay.yoco.com/business-analysis", ozow: "https://pay.ozow.com/business-analysis" },
    'desktop-support': { yoco: "https://pay.yoco.com/desktop-support", ozow: "https://pay.ozow.com/desktop-support" },
    'business-analysis-advanced': { yoco: "https://pay.yoco.com/business-analysis-advanced", ozow: "https://pay.ozow.com/business-analysis-advanced" },
    'youth-digital-literacy': { yoco: "https://pay.yoco.com/youth-digital", ozow: "https://pay.ozow.com/youth-digital" },
    'call-centre-digital-skills': { yoco: "https://pay.yoco.com/call-centre", ozow: "https://pay.ozow.com/call-centre" },
    'youth-programme': { yoco: "https://pay.yoco.com/youth-programme", ozow: "https://pay.ozow.com/youth-programme" },
    'drone-tech': { yoco: "https://pay.yoco.com/drone", ozow: "https://pay.ozow.com/drone" }
};

const itCourses = ['digital-literacy', 'full-stack', 'rpa', 'data-science', 'cloud-devops'];
const businessCourses = ['entrepreneurship', 'business-management', 'financial-literacy', 'digital-marketing', 'project-management', 'executive-education' ];
const bootcampCourses = [ 'cybersecurity', 'business-analysis', 'desktop-support', 'it-support', 'business-analysis-advanced'];
const youthCourses = ['youth-digital-literacy', 'youth-programme', 'drone-tech', 'call-centre-digital-skills'];
---

<BaseLayout title="Training Academy">
    <style>
        .course-card-content { padding: 1.5rem; flex-grow: 1; display: flex; flex-direction: column; }
        .course-card-content h3 { color: var(--color-primary); margin-top: 0; }
        .course-card-content p { margin-bottom: 1.5rem; color: var(--color-text-light); line-height: 1.6; }
        .course-details { margin-top: auto; }

        .module-accordion { border-top: 1px solid var(--color-border); margin-top: 10px; }
        .module-accordion:last-child { border-bottom: 1px solid var(--color-border); }
        .module-accordion summary { padding: 1rem 0; font-weight: 600; color: var(--color-secondary); cursor: pointer; outline: none; list-style: none; position: relative; padding-right: 20px; }
        .module-accordion summary::-webkit-details-marker { display: none; }
        .module-accordion summary::after { content: '+'; position: absolute; right: 0; top: 50%; transform: translateY(-50%); font-size: 1.2rem; color: var(--color-accent); font-weight: bold; }
        .module-accordion[open] > summary::after { content: 'âˆ’'; }
        .module-accordion-content { padding: 0 0 1rem 1rem; border-left: 3px solid var(--color-accent); background-color: #f9f9f9; border-radius: 0 0 8px 8px; }
        .module-accordion-content ul { list-style: none; padding: 0; margin: 0; }
        .module-accordion-content li { margin-bottom: 0.5rem; color: var(--color-text-light); font-size: 0.9rem; padding-left: 10px; position: relative; }
        .module-accordion-content li::before { content: "â€¢"; color: var(--color-accent); position: absolute; left: -5px; }

        .certification-info { background-color: var(--color-light-bg); border-left: 4px solid var(--color-accent); padding: 1rem; margin-top: 1.5rem; margin-bottom: 1rem; border-radius: 4px; font-size: 0.85rem; line-height: 1.4; }
        .certification-info strong { color: var(--color-primary); display: block; margin-bottom: 0.25rem; }
        
        .enroll-button { width: 100%; background-color: var(--color-accent); color: #ffffff; text-align: center; padding: 0.9rem; border-radius: 6px; text-decoration: none; font-weight: 700; transition: all 0.3s ease; display: block; border: none; cursor: pointer; margin-top: auto; }
        .enroll-button:hover { background-color: #3a8ac0; transform: translateY(-1px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 9999; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease; }
        .modal-overlay.open { display: flex; opacity: 1; }
        .payment-modal { background: #fff; width: 90%; max-width: 450px; border-radius: 16px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); text-align: center; transform: translateY(20px); transition: transform 0.3s ease; position: relative; }
        .modal-overlay.open .payment-modal { transform: translateY(0); }
        .modal-close { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; background: none; border: none; color: #999; }
        .modal-title { font-size: 1.5rem; color: #161B45; margin-bottom: 10px; }
        .modal-subtitle { color: #666; margin-bottom: 30px; font-size: 0.95rem; }
        .payment-options { display: flex; flex-direction: column; gap: 15px; }
        .pay-option-btn { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 16px; border-radius: 10px; text-decoration: none; font-weight: 700; transition: transform 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border: 1px solid #eee; }
        .pay-option-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .btn-yoco { background: #161B45; color: white; }
        .btn-ozow { background: #F97316; color: white; }
        .secure-badge { margin-top: 20px; font-size: 0.8rem; color: #888; display: flex; align-items: center; justify-content: center; gap: 5px; }
    </style>

    <main>
        <section class="page-header page-header-academy">
            <div class="hero-overlay"></div>
            <div class="container">
                <div class="hero-content">
                    <h1>Training Academy</h1>
                    <p>Explore our comprehensive catalog of courses and pathways designed to upskill you for the future of work.</p>
                </div>
            </div>
        </section>

        <section class="section section-gray">
            <div class="container">
                <h2 class="section-title text-center">IT Training Courses & Pathways</h2>
                <div class="course-grid">
                    {itCourses.map(id => {
                        const course = courses[id];
                        const links = LINKS[id] || { yoco: '#', ozow: '#' };
                        if (!course) return null;
                        return (
                            <div class="course-card">
                                <div class="course-card-content">
                                    <h3>{course.title}</h3>
                                    <p>{course.description}</p>
                                    <div class="course-details">
                                        {course.modules.map(mod => (
                                            <details class="module-accordion">
                                                <summary>{mod.title}</summary>
                                                <div class="module-accordion-content">
                                                    <ul>{mod.lessons.map(l => <li>- {l.title}</li>)}</ul>
                                                </div>
                                            </details>
                                        ))}
                                        <div style="margin-top: 20px;"></div>
                                        {course.certificateEligible && (
                                            <div class="certification-info"><strong>Certification:</strong> TechBridge {course.title} Certificate</div>
                                        )}
                                        <button class="enroll-button trigger-payment" data-title={course.title} data-yoco={links.yoco} data-ozow={links.ozow}>Enroll Now</button>
                                    </div>
                                </div>
                            </div>
                        );
                    })}
                </div>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title text-center">Business Education Courses</h2>
                <div class="course-grid">
                    {businessCourses.map(id => {
                        const course = courses[id];
                        const links = LINKS[id] || { yoco: '#', ozow: '#' };
                        if (!course) return null;
                        return (
                            <div class="course-card">
                                <div class="course-card-content">
                                    <h3>{course.title}</h3>
                                    <p>{course.description}</p>
                                    <div class="course-details">
                                        {course.modules.map(mod => (
                                            <details class="module-accordion">
                                                <summary>{mod.title}</summary>
                                                <div class="module-accordion-content">
                                                    <ul>{mod.lessons.map(l => <li>- {l.title}</li>)}</ul>
                                                </div>
                                            </details>
                                        ))}
                                        <div style="margin-top: 20px;"></div>
                                        {course.certificateEligible && (
                                            <div class="certification-info"><strong>Certification:</strong> TechBridge {course.title} Certificate</div>
                                        )}
                                        <button class="enroll-button trigger-payment" data-title={course.title} data-yoco={links.yoco} data-ozow={links.ozow}>Enroll Now</button>
                                    </div>
                                </div>
                            </div>
                        );
                    })}
                </div>
            </div>
        </section>

        <section class="section section-gray">
            <div class="container">
                <h2 class="section-title text-center">Business and IT Bootcamp/ Programme</h2>
                <div class="course-grid">
                    {bootcampCourses.map(id => {
                        const course = courses[id];
                        const links = LINKS[id] || { yoco: '#', ozow: '#' };
                        if (!course) return null;
                        return (
                            <div class="course-card">
                                <div class="course-card-content">
                                    <h3>{course.title}</h3>
                                    <p>{course.description}</p>
                                    <div class="course-details">
                                        {course.modules.map(mod => (
                                            <details class="module-accordion">
                                                <summary>{mod.title}</summary>
                                                <div class="module-accordion-content">
                                                    <ul>{mod.lessons.map(l => <li>- {l.title}</li>)}</ul>
                                                </div>
                                            </details>
                                        ))}
                                        <div style="margin-top: 20px;"></div>
                                        {course.certificateEligible && (
                                            <div class="certification-info"><strong>Certification:</strong> TechBridge {course.title} Certificate</div>
                                        )}
                                        <button class="enroll-button trigger-payment" data-title={course.title} data-yoco={links.yoco} data-ozow={links.ozow}>Enroll Now</button>
                                    </div>
                                </div>
                            </div>
                        );
                    })}
                </div>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title text-center">Youth Work-Readiness Program</h2>
                <div class="course-grid">
                    {youthCourses.map(id => {
                        const course = courses[id];
                        const links = LINKS[id] || { yoco: '#', ozow: '#' };
                        if (!course) return null;
                        return (
                            <div class="course-card">
                                <div class="course-card-content">
                                    <h3>{course.title}</h3>
                                    <p>{course.description}</p>
                                    <div class="course-details">
                                        {course.modules.map(mod => (
                                            <details class="module-accordion">
                                                <summary>{mod.title}</summary>
                                                <div class="module-accordion-content">
                                                    <ul>{mod.lessons.map(l => <li>- {l.title}</li>)}</ul>
                                                </div>
                                            </details>
                                        ))}
                                        <div style="margin-top: 20px;"></div>
                                        {course.certificateEligible && (
                                            <div class="certification-info"><strong>Certification:</strong> TechBridge {course.title} Certificate</div>
                                        )}
                                        <button class="enroll-button trigger-payment" data-title={course.title} data-yoco={links.yoco} data-ozow={links.ozow}>Enroll Now</button>
                                    </div>
                                </div>
                            </div>
                        );
                    })}
                </div>
            </div>
        </section>
    </main>

    <div id="payment-modal-overlay" class="modal-overlay">
        <div class="payment-modal">
            <button class="modal-close" id="close-modal">&times;</button>
            <h3 class="modal-title">Enroll in Course</h3>
            <p class="modal-subtitle" id="modal-course-title">Selected Course</p>
            
            <div class="payment-options">
                <a href="#" id="link-yoco" target="_blank" class="pay-option-btn btn-yoco">
                    ðŸ’³ Pay with Card (Yoco)
                </a>
                <a href="#" id="link-ozow" target="_blank" class="pay-option-btn btn-ozow">
                    âš¡ Pay with Instant EFT (Ozow)
                </a>
            </div>

            <div class="secure-badge">
                ðŸ”’ Secure Payment Processed via Yoco/Ozow
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('payment-modal-overlay');
            const closeModal = document.getElementById('close-modal');
            const modalTitle = document.getElementById('modal-course-title');
            const linkYoco = document.getElementById('link-yoco');
            const linkOzow = document.getElementById('link-ozow');

            // Open Modal on Click
            document.querySelectorAll('.trigger-payment').forEach(btn => {
                btn.addEventListener('click', () => {
                    const title = btn.dataset.title;
                    const yoco = btn.dataset.yoco;
                    const ozow = btn.dataset.ozow;

                    modalTitle.textContent = title;
                    linkYoco.href = yoco;
                    linkOzow.href = ozow;

                    modal.classList.add('open');
                });
            });

            // Close Logic
            const close = () => modal.classList.remove('open');
            closeModal.addEventListener('click', close);
            modal.addEventListener('click', (e) => { if(e.target === modal) close(); });
        });
    </script>
</BaseLayout>















